# CODEBUDDY.md

This file provides guidance to CodeBuddy Code when working with code in this repository.

## Project Overview

RocketC is a personal front-end toolkit monorepo managed with pnpm workspaces. It contains UI components, keyboard shortcut utilities, and a CLI tool.

### Packages

- **@rocketc/react** - React UI component library built with Radix UI primitives and Tailwind CSS (shadcn/ui components)
- **@rocketc/shortcuts** - Pure JavaScript keyboard shortcut library with no framework dependencies
- **@rocketc/react-use-shortcuts** - React hooks and context providers for keyboard shortcuts
- **@rocketc/cli** - RocketC command-line tool
- **@rocketc/react-app** - Demo/playground React application

## Common Commands

### Package Management

```bash
# Install dependencies across all packages
pnpm install

# Add a dependency to a specific package
pnpm --filter @rocketc/react add <package>
```

### Development & Building

For individual packages, navigate to the package directory and run:

```bash
# Development server (if applicable)
pnpm dev

# Build the package
pnpm build

# Run linter
pnpm lint

# Fix linting issues
pnpm lint:fix
```

### @rocketc/react Specific Commands

```bash
# Install shadcn/ui components (non-interactive, auto-accept all)
pnpm install-components

# Generate entry file from components and hooks
pnpm gen-entry

# Full build process (runs all steps: install-components, gen-entry, tsc, vite build)
pnpm build
```

Note: The main `build` script in `@rocketc/react` automatically:

1. Installs components via shadcn CLI
2. Generates entry file from `src/components/` and `src/hooks/`
3. Compiles TypeScript with `tsc -b`
4. Builds with Vite
5. Copies CSS file to dist (removing `@source` directive)

### Testing

```bash
# Run tests in packages that use Jest (e.g., @rocketc/shortcuts)
pnpm --filter @rocketc/shortcuts test

# Run tests for a specific test file
pnpm --filter @rocketc/shortcuts test -- src/shortcut-registry.test.ts
```

### Versioning & Publishing

This monorepo uses Changesets for versioning:

```bash
# Create a changeset (prompts for version bump and description)
pnpm changeset

# Apply changesets and update versions
pnpm changeset version

# Publish packages (usually done via CI/CD)
pnpm changeset publish
```

### Pre-commit Hooks

The repository uses Husky with lint-staged for pre-commit checks:

- Automatically formats files with Prettier (excludes `lock.yaml` files)
- Runs `pnpm lint:fix` for TypeScript/JavaScript files

### Commit Messages

Commits use commitlint and follow conventional commit format (e.g., `feat: add new component`, `fix: resolve keyboard conflict`).

## Architecture

### Monorepo Structure

```
rocketc/
├── packages/
│   ├── libs/
│   │   ├── react/              # UI component library
│   │   ├── shortcuts/          # Core shortcuts library (JS-only)
│   │   └── react-use-shortcuts/ # React hooks for shortcuts
│   ├── commands/
│   │   └── cli/                # CLI tool
│   └── playground/
│       └── react-app/          # Demo application
```

### @rocketc/react Package

**Component Organization:**

- Components are located in `src/components/ui/` (shadcn/ui components)
- Custom hooks are in `src/hooks/`
- Entry file (`src/index.ts`) is auto-generated by `gen-entry` script

**Styling:**

- Uses Tailwind CSS v4 with Vite integration
- Radix UI provides accessible primitives
- CSS in `src/index.css` is copied to `dist/tailwind.css` during build
- Components use `class-variance-authority` (CVA) for variant styling
- `clsx` and `tailwind-merge` utilities are available for conditional class merging

**Adding New Components:**

1. Add component to `src/components/ui/` or `src/hooks/`
2. Run `pnpm gen-entry` to update exports
3. The build process will automatically include it

### @rocketc/shortcuts Package

**Architecture:**

- `key-codes.ts` - Key code definitions and constants
- `accelerator-parser.ts` - Parses keyboard accelerator strings (e.g., "Ctrl+Shift+K")
- `shortcut-registry.ts` - Core registry for managing shortcuts

**Testing:**

- Uses Jest with ts-jest preset
- Tests are in `src/` alongside source files (e.g., `accelerator-parser.test.ts`)
- JSDOM environment for DOM-related tests

### @rocketc/react-use-shortcuts Package

**Integration:**

- Depends on `@rocketc/shortcuts` for core functionality
- Provides React-specific implementations via Context API
- Main exports: `ShortcutProvider`, `useShortcut`, `ShortcutContext`

### Dependencies Between Packages

- `@rocketc/react-use-shortcuts` → `@rocketc/shortcuts` (workspace dependency)
- `@rocketc/react-app` → `@rocketc/react` and `@rocketc/react-use-shortcuts` (workspace dependencies)

## Important Notes

### TypeScript Configuration

All packages use TypeScript with multiple tsconfig files:

- `tsconfig.json` - Base configuration
- `tsconfig.lib.json` - Library build configuration
- `tsconfig.node.json` - Node.js scripts configuration
- `tsconfig.test.json` - Test configuration (where applicable)

### Package Manager

This repository uses **pnpm** as the package manager. Always use pnpm commands instead of npm or yarn.

### Workspace Dependencies

Inter-package dependencies use `workspace:*` protocol in package.json files. These are resolved automatically during installation.

### Build Outputs

- Library packages output to `dist/` directory
- TypeScript declaration files (`.d.ts`) are generated
- Vite handles the bundling process

### CSS Handling in @rocketc/react

The build process automatically removes Tailwind CSS `@source` directives from the copied CSS file in `dist/tailwind.css`. This is necessary because the directive is only needed during development.
